# 闭包

## 初识

```javascript
function a() {
  var i = 0;

  function b() {
    alert(++i);
  }

  return b;
}

var c = a();

c();
```

这段代码有两个特点：
1、函数b嵌套在函数a内部；
2、函数a返回函数b。
这样在执行完`var c=a()`后，变量c实际上是指向了函数b，再执行`c()`后就会弹出一个窗口显示i的值（第一次为1）。这段代码其实就创建了一个闭包，这是因为函数a外的变量c引用了函数a内的函数b。也就是说，当函数a的内部函数b被函数a外的一个变量引用的时候，就创建了一个闭包。

## 作用

简而言之，闭包的作用就是在a执行完并返回后，闭包使得Javascript的垃圾回收机制不会收回a所占用的资源，因为a的内部函数b的执行需要依赖a中的变量。

在上面的例子中，由于闭包的存在使得函数a返回后，a中的i始终存在，这样每次执行c()，i都是自加1后alert出i的值。

那么我们来想象另一种情况，如果a返回的不是函数b，情况就完全不同了。因为a执行完后，b没有被返回给a的外界，只是被a所引用，而此时a也只被b引用，函数a和b互相引用但又不被外界打扰（被外界引用），函数a和b就会被回收

## 更深一步理解

[link](https://zhuanlan.zhihu.com/p/22486908)

闭包就是有一个局部变量 i，有一个函数 b，b 里面可以访问到 i 变量。换句话说**「函数」和「函数内部能访问到的变量」的总和，就是一个闭包**

有的同学就疑惑了，闭包这么简单么？

「我听说闭包是需要函数套函数，然后 return 一个函数的呀！」, 就像上方的`return b;`一样. 其实跟有没有return没关系, return b 只是为了 b 能被使用，跟闭包无关。因为如果不 return，你就无法使用这个闭包。把 return b 改成 window.b = b 也是一样的，只要让外面可以访问到这个 bar 函数就行了。

## 更进一步作用

闭包常常用来「间接访问一个变量」。换句话说，「隐藏一个变量」。 假设我们在做一个游戏，在写其中关于「还剩几条命」的代码。如果不用闭包，你可以直接用一个全局变量：`window.lives = 30 // 还有三十条命`。 这样看起来很不妥。万一不小心把这个值改成 -1 了怎么办。所以我们不能让别人「直接访问」这个变量。怎么办呢？用局部变量。但是用局部变量别人又访问不到，怎么办呢？ 暴露一个访问器（函数），让别人可以「间接访问」。

```javascript
function(){

  var lives = 50

  window.奖励一条命 = function(){
    lives += 1
  }

  window.死一条命 = function(){
    lives -= 1
  }

}()
```

那么在其他的 JS 文件，就不能直接修改这个变量的值，但是可以使用 `window.奖励一条命()` 来涨命，使用 `window.死一条命()` 来让角色掉一条命。

## 你根本不需要知道闭包这个概念，一样可以使用闭包

闭包是 JS 函数作用域的副产品。换句话说，正是由于 JS 的函数内部可以使用函数外部的变量，所以这段代码正好符合了闭包的定义。而不是 JS 故意要使用闭包。很多编程语言也支持闭包，另外有一些语言则不支持闭包。只要你懂了 JS 的作用域，你自然而然就懂了闭包，即使你不知道那就是闭包！
