# redis单线程

redis单线程主要指的是redis的网络请求处理是单线程的，也就是说redis是一个单线程的服务器，这个单线程主要负责网络请求的接收、处理和返回，而不是指redis是单线程的, 他的持久化, 集群同步等是多线程的.

redis快的原因主要因为采用了I/O多路复用机制处理socket请求. 

redis 4.0后引入了多线程, 主要体现在大数据删除上, 通过多线程删除大数据, 避免阻塞主线程.

redis 6.0后新增了多线程读写并发能力.

## 具体流程

**6.0前:**

```
客户端请求到达：客户端向 Redis 服务器发送请求。

I/O 多路复用：Redis 使用 select、poll 或 epoll 监听多个客户端连接的可读事件。

事件触发：当某个客户端 socket 有数据到达时，I/O 多路复用机制通知 Redis 主线程。

主线程处理 I/O：

- 数据读取：主线程读取客户端发送的数据。
- 命令解析：主线程解析读取到的数据并确定要执行的命令。
- 命令执行：主线程根据解析结果执行相应的命令（例如，查询数据库、写入数据等）。
- 响应生成：主线程根据命令执行结果生成响应数据。
- 数据写入：主线程将生成的响应数据写回客户端 socket。

响应返回客户端：客户端接收到响应数据。
```

**6.0后:**

```
客户端请求到达：客户端向 Redis 服务器发送请求。

I/O 多路复用：主线程通过 I/O 多路复用机制监听客户端连接的可读事件。

多线程 I/O 处理：

- 数据读取：I/O 线程从客户端 socket 读取请求数据。

主线程处理请求：

- 命令解析：主线程解析请求中的命令。
- 命令执行：主线程执行相应的操作。
- 响应生成：主线程生成响应数据。

多线程 I/O 响应：

- 数据写入：I/O 线程将响应数据写回到客户端 socket。

响应返回客户端：客户端接收到响应。

通过引入多线程处理 I/O 操作，Redis 6.0 及以后的版本显著提高了高并发场景下的性能，尤其是在网络 I/O 繁重的情况下。
```

### 总结

Redis 6.0 之前：单线程处理所有的 I/O 操作和命令执行。虽然使用了 I/O 多路复用机制来处理多个连接，但所有操作都由主线程完成。
Redis 6.0：引入了 I/O 多线程，I/O 操作由多个线程处理，而主线程负责命令解析和执行。这样可以显著提高高并发场景下的性能，特别是在网络 I/O 繁重的情况下。
