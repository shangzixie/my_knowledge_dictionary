# zset

如果有序集合的元素个数小于 128 个，并且每个元素的值小于 64 字节时，Redis 会使用压缩列表ziplist (redis 7.0前), listpack(redis 7.0后) 作为 Zset 类型的底层数据结构；

如果有序集合的元素不满足上面的条件，Redis 会使用跳表作为 Zset 类型的底层数据结构；

## 跳表

![113](/Image/database/113.png)
![114](/Image/database/114.png)

### 查找时间复杂度

按分值查找（通过score查找）：zset 使用跳表（SkipList）来维护元素的有序性，跳表的查找时间复杂度是 O(log n)，所以按分值查找的时间复杂度是 O(log n)。

按排名查找（通过rank查找）：如果是通过排名来查找元素（例如zset中按顺序获取第几个元素），因为跳表是按照分值顺序维护的，所以查找时间复杂度也是 O(log n)。

按成员查找（通过成员名查找）：Redis zset 内部有一个哈希表（Hash Table），用于通过成员名快速定位到元素，所以按成员查找的时间复杂度是 O(1)。

### Redis跳表与MySQLB+树

MySQL 的 B+ 树和 Redis 的跳表都是用于存储有序数据的数据结构，但它们有一些关键的区别，使得它们在不同的场景和用途中各有优势。

1. 结构差异：B+ 树是一种多路搜索树，每个节点可以有多个子节点，而跳表是一种基于链表的数据结构，每个节点只有一个下一个节点，但可以有多个快速通道指向后面的节点。

2. 空间利用率：B+ 树的磁盘读写操作是以页（通常是 4KB）为单位的，每个节点存储多个键值对，可以更好地利用磁盘空间，减少 I/O 操作。而跳表的空间利用率相对较低。

3. 插入和删除操作：跳表的插入和删除操作相对简单，时间复杂度为 O(logN)，并且不需要像 B+ 树那样进行复杂的节点分裂和合并操作。

4. 范围查询：B+ 树的所有叶子节点形成了一个有序链表，因此非常适合进行范围查询。而跳表虽然也可以进行范围查询，但效率相对较低。


## reference

[包含ziplist和listpack](https://blog.csdn.net/u013277209/article/details/125998869)